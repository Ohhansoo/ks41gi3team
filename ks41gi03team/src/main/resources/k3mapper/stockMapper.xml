<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="k3.stock.ahs.mapper.K3StockMapper">
	<resultMap type="K3Stock" id="warehousingResultMap">
 		<result column="laydownCheckCode" property="laydownCheckCode" />
 		<result column="laydownGoodsName" property="laydownGoodsName" />
		<result column="stockQuantity" property="stockQuantity" />
		<result column="contractorName" property="contractorName" />
		<result column="largeCategory" property="largeCategory" />
		<result column="mediumCategory" property="mediumCategory" />
		<result column="smallCategory" property="smallCategory" />
		<result column="locationCode" property="locationCode" />
		<result column="sortingDate" property="sortingDate" />
		<result column="sortingManagerName" property="sortingManagerName" />
	</resultMap>

	<select id="k3GetStockByLocation" resultType="K3Stock">
		SELECT
			w.laydownCheckCode,
			w.laydownGoodsName,
			p.stockQuantity,
			c.contractorName,
			t.largeCategory,
			t.mediumCategory,
			t.smallCategory,
			p.locationCode,
			p.sortingDate,
			m.memberName AS sortingManagerName
		FROM
			k3_tb_pileup AS p
			INNER JOIN
			k3_tb_warehousing AS w
			ON
			p.warehousingCode = w.warehousingCode
			INNER JOIN
			k3_tb_contractor_staff AS c
			ON
			w.contractorId = c.contractorId
			INNER JOIN
			k3_tb_total_category AS t
			ON
			p.categoryCode = t.categoryCode
			INNER JOIN
			k3_tb_member AS m
			ON
			p.sortingManager = m.memberId;
	</select>
	
	<select id="k3GetStockByStockName" resultType="K3Stock">
		SELECT
			w.laydownGoodsName,
			s.contractorName,
			SUM(p.stockQuantity) AS stockQuantity
		FROM
			k3_tb_pileup AS p
			INNER JOIN
			k3_tb_warehousing AS w
			ON
			p.warehousingCode = w.warehousingCode
			INNER JOIN
			k3_tb_contractor_staff AS s
			ON
			w.contractorId = s.contractorId
			GROUP BY s.contractorName, w.laydownGoodsName;
	</select>

</mapper>