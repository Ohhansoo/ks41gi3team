<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="k3.stock.ahs.mapper.K3StockMapper">
	<resultMap type="K3Stock" id="warehousingResultMap">
 		<result column="laydownCheckCode" property="laydownCheckCode" />
 		<result column="laydownGoodsName" property="laydownGoodsName" />
		<result column="stockQuantity" property="stockQuantity" />
		<result column="contractorName" property="contractorName" />
		<result column="largeCategory" property="largeCategory" />
		<result column="mediumCategory" property="mediumCategory" />
		<result column="smallCategory" property="smallCategory" />
		<result column="locationCode" property="locationCode" />
		<result column="pileupDate" property="pileupDate" />
		<result column="pileupManager" property="pileupManager" />
		<result column="pileupManagerName" property="pileupManagerName" />
	</resultMap>

	<select id="k3GetStockByLocation" resultType="K3Stock">
		SELECT
			w.laydownCheckCode,
			w.laydownGoodsName,
			s.stockQuantity,
			c.contractorName,
			t.largeCategory,
			t.mediumCategory,
			t.smallCategory,
			s.locationCode,
			s.pileupDate,
			m.memberName AS pileupManagerName
		FROM
			k3_tb_stock AS s
			INNER JOIN
			k3_tb_warehousing AS w
			ON
			s.warehousingCode = w.warehousingCode
			INNER JOIN
			k3_tb_contractor_staff AS c
			ON
			w.contractorId = c.contractorId
			INNER JOIN
			k3_tb_total_category AS t
			ON
			s.categoryCode = t.categoryCode
			INNER JOIN
			k3_tb_member AS m
			ON
			s.pileupManager = m.memberId;
	</select>
	
	<select id="k3GetStockByStockName" resultType="K3Stock">
		SELECT
			w.laydownGoodsName,
			cs.contractorName,
			SUM(s.stockQuantity) AS stockQuantity
		FROM
			k3_tb_stock AS s
			INNER JOIN
			k3_tb_warehousing AS w
			ON
			s.warehousingCode = w.warehousingCode
			INNER JOIN
			k3_tb_contractor_staff AS cs
			ON
			w.contractorId = cs.contractorId
			GROUP BY cs.contractorName, w.laydownGoodsName;
	</select>

</mapper>